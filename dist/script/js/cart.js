require.config({baseUrl:"https://cdnjs.cloudflare.com/ajax/libs/",paths:{jquery:"jquery/1.12.4/jquery.min",jqcookie:"jquery-cookie/1.4.1/jquery.cookie.min",jqvalidate:"jquery-validate/1.19.0/jquery.validate.min",jqlzload:"jquery.lazyload/1.9.1/jquery.lazyload.min"}}),define("config",function(){}),define("cart",["config"],function(){require(["jquery"],function(){$(".tools").load("tools.html .public"),$("#footer").load("footer.html .footer_information"),$(function(){function t(){this.box=$("#cart_section_has .close_count"),this.scroll()}function s(){this.box=$("#cart_section_has .shopping_list .shopping_products .list"),this.empty=$("#cart_section_empty"),this.has=$("#cart_section_has"),this.str()}function o(){this.products_count_box=$("#cart_section_has .shopping_list .list_show .count_box input"),this.oninput()}function n(){this.checkall=$("#cart_section_has .checkall"),this.checkall2=$("#cart_section_has .checkall2"),this.checkone=$("#cart_section_has .checkone"),this.onemoney=$("body#cart .list_show .red span"),this.total=$("body#cart .list_total .red span"),this.subtotal=$("body#cart .subtotal .red span"),this.products_count_box=$("#cart_section_has .shopping_list .list_show .count_box input"),this.products_count=$("#cart_section_has .close_count .left > span .red"),this.add=$("#cart_section_has .shopping_list .list_show .count_box >.add"),this.reduce=$("#cart_section_has .shopping_list .list_show .count_box >.reduce"),this.money_total(),this.products_count_num()}function i(){this.checkall=$("#cart_section_has .checkall"),this.checkall2=$("#cart_section_has .checkall2"),this.checkone=$("#cart_section_has .checkone"),this.onemoney=$("body#cart .list_show .red span"),this.total=$("body#cart .list_total .red span"),this.subtotal=$("body#cart .subtotal .red span"),this.products_count_box=$("#cart_section_has .shopping_list .list_show .count_box input"),this.products_count=$("#cart_section_has .close_count .left > span .red"),this.add=$("#cart_section_has .shopping_list .list_show .count_box >.add"),this.reduce=$("#cart_section_has .shopping_list .list_show .count_box >.reduce"),this.add_click(),this.reduce_click(),this.check()}function e(){this.one_remove=$("#cart_section_has .shopping_list .list_show .delete a:last-child"),this.many_remove=$("#cart_section_has .close_count .left > a"),this.delete_line(),this.delete_check()}require(["jqcookie"],function(){$.cookie("username")?($(".welcome .unlogin").hide().siblings().show().children(".user").html($.cookie("username")),$(".welcome .out").on("click",function(){$.cookie("username",null,{expires:-1}),window.location.reload(!0)}),$("#cart_section_unlogin").hide(),new s):$("#cart_section_unlogin").show().nextUntil("#fixedbar").hide()}),t.prototype={scroll:function(){var t=this,s=this.box.offset().top;$(window).on("scroll resize",function(){$(window).scrollTop()+$(window).height()<s+110?t.box.css({position:"fixed",bottom:"0px",left:"50%","z-index":2e4,"margin-left":"-542px"}):t.box.css({position:"static",margin:"40px auto"})})}},new t,s.prototype={str:function(){var t=this;$.ajax({url:"http://10.31.155.148/dangdang--/php/cart.php",dataType:"json"}).done(function(s){if(s[0]){t.empty.hide().siblings("#cart_section_has").show();var c="";$.each(s,function(t,s){var o=s.url.split(",")[0],n=(s.title,s.price,s.count);c+='<div class="list_show" s_id="'+s.id+'"><div class="checkbox checkone"><a href="javascript:;" class="on"></a></div><div class="img"><img src="'+o+'" alt="" /></div><div class="content"><a href="javascript:;">'+s.title+'</a></div><div class="one_money"><span>¥'+s.price+'</span><span class="red">限时抢</span></div><div class="count"><div class="count_box"><a href="javascript:;" class="reduce">-</a><input type="text" class="checkon" value="'+n+'" /><a href="javascript:;" class="add">+</a></div></div><div class="money_total"><span class="red">¥<span class="checked">'+s.price+'</span></span></div><div class="delete"><a href="javascript:;">移入收藏</a><a href="javascript:;">删除</a></div></div>'}),t.box.prepend(c),new i,new e,new o,new n}else t.empty.show().siblings("#cart_section_has").hide()})}},o.prototype={oninput:function(){this.products_count_box.on("input",function(){var t=/^\d+$/g,s=$(this).val();-1!=s.search(t)?s>=99?$(this).val(99):s<=0?$(this).val(1):$(this).val(s):$(this).val(1),new n;var o=$(this).parents(".list_show").attr("s_id"),i=$(this).val();console.log(i),$.ajax({url:"http://10.31.155.148/dangdang--/php/cart.php",data:{input_id:o,input_num:i}})})}},n.prototype={products_count_num:function(){var t=0;this.products_count_box.each(function(){void 0==$(this).parents(".list_show").find(".checkon").val()?t+=0:t+=+$(this).parents(".list_show").find(".checkon").val()}),this.products_count.html(t),require(["jqcookie"],function(){$.cookie("products",t,{expires:10}),$(".tools_nav a i").text(t)})},money_total:function(){this.price_box=$("#cart_section_has .shopping_list .list_show .one_money > span:first-child"),this.count_box=$("#cart_section_has .shopping_list .list_show .count_box input");var t=0;this.onemoney.each(function(){$(this);$(this).attr("price",$(this).parents(".list_show").children(".one_money").children("span").eq(0).html().substring(1)),$(this).attr("count",$(this).parents(".list_show").children(".count").children().children("input").val()),$(this).html(($(this).attr("price")*$(this).attr("count")).toFixed(2))}),this.onemoney.each(function(){void 0==$(this).parents(".list_show").find(".checked").html()?t+=0:t+=+$(this).parents(".list_show").find(".checked").html()}),this.total.html(t.toFixed(2)),this.subtotal.html(t.toFixed(2))}},i.prototype={add_click:function(){var t=0;this.add.on("click",function(){t=$(this).prev().val(),t++,t>99&&(t=99),$(this).prev().val(t),new n;var s=$(this).parents(".list_show").attr("s_id"),o=$(this).prev().val();$.ajax({url:"http://10.31.155.148/dangdang--/php/cart.php",data:{input_id:s,input_num:o}})})},reduce_click:function(){this.reduce.on("click",function(){var t=+$(this).next().val();t--,t<1&&(t=1),$(this).next().val(t),new n;var s=$(this).parents(".list_show").attr("s_id"),o=$(this).next().val();$.ajax({url:"http://10.31.155.148/dangdang--/php/cart.php",data:{input_id:s,input_num:o}})})},check:function(){var t=this;this.checkall.on("click",function(){"on"==$(this).children().attr("class")?(t.checkall.find(".on").removeClass("on"),setTimeout(function(){t.checkall2.find(".on").removeClass("on"),t.checkone.find(".on").removeClass("on"),t.onemoney.removeClass("checked"),t.products_count_box.removeClass("checkon")},200)):(t.checkall.find("a").addClass("on"),setTimeout(function(){t.checkall2.find("a").addClass("on"),t.checkone.find("a").addClass("on"),t.onemoney.addClass("checked"),t.products_count_box.addClass("checkon")},200)),setTimeout(function(){new n},200)}),this.checkall2.on("click",function(){"on"==$(this).children().attr("class")?(t.checkall2.find(".on").removeClass("on"),t.checkone.find(".on").removeClass("on"),t.onemoney.removeClass("checked"),t.products_count_box.removeClass("checkon"),setTimeout(function(){t.checkall.find(".on").removeClass("on")},200)):(t.checkall2.find("a").addClass("on"),t.checkone.find("a").addClass("on"),t.onemoney.addClass("checked"),t.products_count_box.addClass("checkon"),setTimeout(function(){t.checkall.find("a").addClass("on")},200)),new n}),this.checkone.on("click",function(){"on"==$(this).children().attr("class")?($(this).find(".on").removeClass("on"),$(this).parents(".list_show").find(".checked").removeClass("checked"),$(this).parents(".list_show").find(".checkon").removeClass("checkon"),t.checkall2.find(".on").removeClass("on"),setTimeout(function(){t.checkall.find(".on").removeClass("on")},200)):($(this).find("a").addClass("on"),$(this).parents(".list_show").find(".red span").addClass("checked"),$(this).parents(".list_show").find(".count_box input").addClass("checkon"),t.checkone.size()==t.checkone.find(".on").size()&&(t.checkall2.find("a").addClass("on"),setTimeout(function(){t.checkall.find("a").addClass("on")},200))),new n})}},e.prototype={delete_line:function(){this.one_remove.on("click",function(){var t=[],s=$(this).parents(".list_show").find(".checkon").val(),o=$("#cart_section_has .close_count .left > span .red").html();t.push($(this).parents(".list_show").attr("s_id")),confirm("请确认是否删除")&&(require(["jqcookie"],function(){$.cookie("products",o-s,{expires:10}),$(".tools_nav a i").text(o-s)}),$.ajax({type:"get",url:"http://10.31.155.148/dangdang--/php/cart.php",data:{id:t,length:t.length}}).done(function(){window.location.reload(!0)}))})},delete_check:function(){this.many_remove.on("click",function(){var t=$("#cart_section_has .shopping_list .list_show .checkbox a.on").parents(".list_show"),s=[],o=0;t.each(function(){s.push($(this).attr("s_id")),o+=$(this).find(".checkon").val()});var n=$("#cart_section_has .close_count .left > span .red").html();confirm("请确认是否批量删除")&&(require(["jqcookie"],function(){$.cookie("products",n-o,{expires:10}),$(".tools_nav a i").text(n-o)}),$.ajax({type:"get",url:"http://10.31.155.148/dangdang--/php/cart.php",data:{id:s,length:s.length}}).done(function(){window.location.reload(!0)}))})}}})})});